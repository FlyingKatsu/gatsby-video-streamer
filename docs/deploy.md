| [GitHub Repo](https://github.com/FlyingKatsu/gatsby-video-streamer) | [Live Demo](https://demo.flyingkatsu.com/video-stream) |

# Deploy your Website

## Basic Steps

1. In `site-config.js`, modify the following values
  a. `pathPrefix` (line 35) the subdirectory for your website files (`www/path-prefix/index.html`)
  b. `siteUrl` (line 44) currently not used, but in the future it will be used for metadata
  c. `externalPathDev` (line 75) when running `gatsby develop`, this is the URL to your server stream files (`https://demo.flyingkatsu.com/_stream`)
  d. `externalPathServ` (line 78) the relative path to your server stream files (`/_stream` for `www/_stream/hls/my-video/stream.m3u8`)
2. Run `gatsby build --prefix-paths` to generate `public/` files for a production server for a destination of `www/path-prefix/index.html` (you may first want to delete `.cache` and `public/` to avoid copying outdated files to your webserver)
3. Test your build in a browser locally with `gatsby serve --path-prefix -o` (`-o` opens localhost URL in browser)

## About the Demo

The official GatsbyJS documentation describes several methods for deploying to various web services, but note that some services, like Netlify, limit your upload file sizes to 10MB, which is not viable for video files.

The [Live Demo](https://demo.flyingkatsu.com/video-stream) runs on NGINX with an HTTPS certification from [Let's Encrypt](https://letsencrypt.org/docs/client-options/). 

Note: If you want videos to be shared via Twitter cards, you need to have HTTPS enabled!

The demo file structure looks like this:

```
www/
    _stream/
        dash/
            my-video/
                stream.mpd
                audio/
                video/
        hls/
            my-video/
                stream.m3u8
                segment.ts
    public/
        blog/
        playlist/
        video/
        static/
        index.html
```

where  
- `_stream` contains all the necessary stream files, with the original directory structure preserved
- `public` contains all the files generated by `gatsby build` or `npm run build`


NOTE: The demo videos are not viewable since I have not yet configured the server with media streaming modules:

## Apache Modules

- http://headstation.com/archives/configure-h-264-high-definition-video-streaming-apache/

## NGINX Modules

### Official modules
- http://nginx.org/en/docs/http/ngx_http_mp4_module.html
- http://nginx.org/en/docs/http/ngx_http_hls_module.html

### Debian package
- https://packages.debian.org/sid/libnginx-mod-rtmp

### Some other ones that require custom build
- https://github.com/arut/nginx-rtmp-module
- https://github.com/kaltura/nginx-vod-module